# 单总体比例检验

- [单总体比例检验](#单总体比例检验)
  - [简介](#简介)
  - [z-test](#z-test)

2024-06-07
@author Jiawei Mao
***

## 简介

下面介绍针对单个总体的比例检验。

在生物学研究中，许多数据是用比例表示的。当总体或样本中的个体分为两种属性，如药剂处理后害虫的死与活，种子的发芽与不发芽，动物的雌和雄等，类似这样的性状组成的总体通常服从**二项分布**。

设二项分布中具有“目标性状”的个体的比例为 $p$，另一种的比例为 $q$，则 $p+q=1$。如果 $np\ge 5$ 并且 $nq \ge 5$，那么 $\hat{p}$ 的抽样分布近似为正态分布，均值 $\mu_{\hat{p}}=p$，标准差为：
$$
\sigma_{\hat{p}}=\sqrt{pq/n}
$$

## z-test

当二项分布满足 $np \ge 5$ 且 $nq \ge 5$，可以用 z-test 检验总体比例。

检验统计量为样本比例 $\hat{p}$，标准化检验统计量为：
$$
z=\frac{\hat{p}-\mu_{\hat{p}}}{\sigma_{\hat{p}}}=\frac{\hat{p}-p}{\sqrt{pq/n}}
$$
**操作步骤：**

1. 确定 $\hat{p}$ 的抽样分布是否可以用正态分布近似：$np \ge 5$, $nq\ge 5$；
2. 声明假设 $H_0$ 和 $H_a$；
3. 指定显著性水平 $\alpha$；
4. 计算临界值；
5. 确定拒绝域；
6. 计算标准化检验统计量；
7. 下结论；
8. 解释。

**例 1** 单个比例的假设检验

一个研究人员称，只有不到 45% 的美国成年人因为复杂密码难记而使用不太安全的密码。在对 100 名成年人的随机抽样调查中，41% 的人说因为复杂密码难以记忆而使用不太安全的密码。取 $\alpha=0.01$，是否有足够证据支持该研究者的说法。

1. $np=100*0.45=45$, $nq=100*0.55=55$，均大于 5，可以使用 z-test；
2. 报告是“不到 45%”，因此声明假设 $H_0$: $p\ge 0.45$，$H_a$：$p<0.45$；
3. 显著性水平 $\alpha=0.01$；
4. 计算临界值，显然，这是左边假设，临界值：

```java
double v = ZTestUtils.getLeftCriticalValue(0.01);
assertEquals(v, -2.33, 0.01);
```

5. 确定拒绝域：$z < -2.33$；
6. 计算标准化检验统计量

```java
double z = ZTestUtils.getStatistic(0.41, 0.45, 100);
assertEquals(z, -0.80, 0.01);
```

7. 结论：z 没有在拒绝域内，因此无法拒绝 null 假设；
8. 解释：在 1% 显著性水平下，没有足够证据支持说法：只有不到 45% 的美国成年人因为复杂密码太难记而使用不安全的密码。

也可以采用 p-value 方法。和单总体均值检验一样，只是 z 统计量的计算方法不同。

> 如果样本比例没有给出，可以用 $\hat{p}=\frac{x}{n}$ 来计算，其中 x 是成功样本数，n 为样本个数。

**例 2** 单总体比例检验

一位研究人员称，51% 的美国成年人错误地认为抗生素对病毒有效。随机抽取 2202 名成年人，1161 人表示抗生素对病毒有效。在 $\alpha=0.10$ 时，是否有足够证据支持该研究人员的说法？

1. $np=2202*0.51\approx 1123$，$nq=2202*0.49\approx 1079$，因此可以用 z-test；
2. $H_0$：$p=0.51$, $H_a$：$p\ne 0.51$；
3. $\alpha=0.10$；
4. 计算临界值，根据假设知为双边检验：

```R
System.out.println(ZTestUtils.getCriticalValue(0.10)); 
// <-1.644853626951473,1.6448536269514724>
```

5. 计算标准化检验统计量

样本 ratio $\hat{p}=\frac{1161}{2202}\approx 0.527$

```r
System.out.println(ZTestUtils.getStatistic(1161 / 2202., 0.51, 2202));
// 1.6190608635924506
```

6. 结论：z 没有落在拒绝域，所以无法拒绝 null 假设；
7. 解释：在 10% 的显著性水平下，没有足够证据拒绝说法：51% 的美国成年人错误地认为抗生素有效。