# 条件分布

2023-05-26
****
## 1. 简介

在联合分布和相关系数部分，我们讨论了两个随机变量 $X$ 和 $Y$ 的联合行为。下面讨论已知一个随机变量 $X$，计算另一个随机变量 $Y$ 的条件概率分布。

主要内容：

- 联合概率分布和条件概率分布的区别
- 条件概率分布其实特定亚群（sub-population）的概率分布
- 给定离散随机变量 $X$ 时随机变量 $Y$ 的条件概率密度函数
- 给定离散随机变量 $X$ 时随机变量 $Y$ 的条件均值和方差

```ad-note
这里联合概率分布（joint probability distribution）和二元概率分布（bivariate probability distribution）等价。
```

## 2. 什么是条件分布

下面通过示例来解释联合概率分布和条件概率分布的区别。

**例：** 某汽车保险公司的安全员想了解车祸中个人受伤的程度与事故发生时个人佩戴的安全措施类型的关系。因此，该安全员根据当地救护车和警察记录编制了如下的联合概率表格：

$$
\begin{array}{c|ccc|c}
f(x,y) & &\text{安全措施类型 (Y)} \\ \hline
\text{受伤程度 (X)} & \text{无 (0)} & \text{安全带 (1)} & \text{安全带+肩带 (2)} & f_X(x) \\ \hline
无 (0) & 0.065 & 0.075 & 0.06 & 0.20 \\ \hline
轻伤 (1) & 0.175 & 0.16 & 0.115 & 0.45 \\ \hline
重伤 (2) & 0.135 & 0.10 & 0.065 & 0.30 \\ \hline
死亡 (3) & 0.025 & 0.015 & 0.01 & 0.05 \\ \hline
f_X(y) & 0.40 & 0.35 & 0.25 & 1.00
\end{array}
$$

其中，"安全带" 表示只戴安全带，"安全带+肩带" 表示同时使用安全带和肩带。其中随机变量 X 表示受伤程度： 0（无）、1（轻伤）、2（重伤）和 3（死亡）；随机变量 $Y$ 表示安全措施：0（无）、1（安全带）和 2（安全带+肩带）。

现在安全员需要知道如下问题，在一场车祸中：

- 随机选择一个人系"安全带"受轻伤的概率？
- 随机选择一个人"无"安全措施死亡的概率？
- 随机选择一个没有受伤的人，这个人（安全带+肩带）的概率？

在回答这些问题前，先给出几个定义（非正式）。

```ad-summary
title:Definition

联合概率分布描述从总体（population）随机选择的人具有两个感兴趣特征的概率。
```

**问题 1**：一个随机选择的人在事故中系安全带、受轻伤的概率？

这是一个联合概率问题。设事件 A 为车祸中随机选择的人受轻伤，事件 B 为随机选择的人佩戴安全带。根据上表有：

$$P(A\text{ and }B)=P(X=1, Y=1)=f(1, 1)=0.16$$
即在车祸中随机选择的一个人受轻伤、佩戴安全带的概率是 16%。

当然，为了完全定义 $X$ 和 $Y$ 的联合概率分布，需要找到联合支集 $S$ 中每个元素的概率。不过这儿介绍联合概率只是为了方便解释联合概率与条件概率的差别。

```ad-summary
title: 条件概率分布

条件概率分布是亚群的概率分布，描述从亚群选择的人具有某个感兴趣特征的概率。
```

**问题2：** 随机选择的人没采取安全措施，死亡概率是？

这是一个条件概率问题。亚群是没有采取安全措施的人集合（NR），感兴趣的特征是死亡（D）。根据条件概率定义：

$$P(D|NR)=\frac{P(D\cap NR)}{P(NR)}=\frac{P(X=3,Y=0)}{P(Y=0)}=\frac{f(3,0)}{f_Y(0)}=\frac{0.025}{0.40}=0.0625$$
即随机选择一个人，如果她没有采取安全措施，则死亡概率为 6.25%。

为了完全定义给定 $Y$ 下 $X$ 的条件概率分布，需要找到联合支集 $S$ 中每个 $X=x, Y=y$ 元素的概率，而不仅仅是 $X=3, Y=0$。不过这里只是想说明**条件概率分布是从亚群随机选择的人具有某个感兴趣特征的概率**。

**问题3：** 如果一个随机选择的人没有受伤，那么这个人采用（安全带+肩带）的概率是多少？

这依然是一个条件概率问题。首先将问题拆分为两部分，确定亚群和感兴趣特征。这里，亚群是没有受伤的人群（NI），感兴趣特征是采用了"安全带+肩带"（SH）。计算条件概率：

$$P(SH|NI)=\frac{P(SH\cap NI)}{P(NI)}=\frac{P(X=0,Y=2)}{P(X=0)}=\frac{f(0,2)}{f_X(0)}=\frac{0.06}{0.20}=0.30$$
即在一场车祸中，随机选择一个人，如果他没有受伤，那么他采用"安全带+肩带" 的概率是 30%。

同样，要充分定义给定 $X$ 下 $Y$ 的条件概率分布，需要知道联合支集 $S$ 下每个 $Y=y, X=x$ 元素的概率，而不仅仅是 $X=0, Y=2$。不过这里仅仅是为了强调条件概率分布是从亚群中随机选择一个人，该人具有某个感兴趣特征的概率。

## 3. 定义

对条件概率分布有了初步印象后，下面给出离散随机变量 $X$ 和 $Y$ 的条件概率分布的正式定义。稍后将其扩展到连续随机变量。

设 X 和 Y 在空间 S 上服从 PMF 为 $f(x,y)$ 的联合离散分布。设边缘 PMF 分别为空间 $S_x$ 上的 $f_X(x)$ 和空间 $S_Y$ 上的 $f_Y(y)$。设事件 $A=\{X=x\}$，事件 $B=\{Y=y\}$，$(x,y)\in S$。因此 $A\cap B=\{X=x,Y=y\}$。因为：

$$P(A\cap B)=P(X=x,Y=y)=f(x,y)$$
并且：

$$P(B)=P(Y=y)=f_Y(y)>0 \qquad y\in S_y$$
给定事件 B，事件 A 的条件概率：

$$P(A|B)=\frac{P(A\cap B)}{P(B)}=\frac{f(x,y)}{f_Y(y)}$$
由此，得到如下定义。

```ad-summary
title: X 的条件概率质量函数

当 $Y=y$，$X$ 的条件概率质量函数（PMF）为：

$$g(x|y)=\frac{f(x,y)}{f_Y(y)}, \qquad f_Y(y)>0$$
```

```ad-summary
title: Y 的条件概率质量函数

当 $X=x$，$Y$ 的条件概率质量函数（PMF）为：

$$h(y|x)=\frac{f(x,y)}{f_X(x)}, \qquad f_X(x)>0$$
```

下面来计算给定 $X$ 时 $Y$ 的条件概率，以及给定 $Y$ 时 $X$ 的条件概率。

**问题 1：** 设 $X$ 是支集 $S_1=\{0,1\}$ 上的离散随机变量，$Y$ 是支集 $S_2=\{0,1,2\}$ 上的离散随机变量。假设 $X$ 和 $Y$ 具有如下的联合概率分布 $f(x,y)$：

$$
\begin{array}{c|ccc|c}f(X,Y) & &Y \\ \hline
X& 0 & 1 & 2 & f_X(x) \\ \hline
0 & 1/8 & 2/8 & 1/8 & 4/8 \\ \hline
1 & 2/8 & 1/8 & 1/8 & 4/8 \\ \hline
f_Y(y) & 3/8 & 3/8 & 2/8 & 1
\end{array}
$$
计算给定 $Y$ 时 $X$ 的条件分布，即 $g(x|y)$?

**答：** 使用公式 $f(x|y)=\frac{f(x,y)}{f_Y(y)}$ ，其中 $x\in \{0,1\}$，$y\in \{0,1,2\}$，给定 $Y$ 时 $X$ 的条件分布为：

$$
\begin{array}{c|ccc}
g(x|y) & & Y \\ \hline
X &0 &1 &2 \\ \hline
0 & 1/3 & 2/3 & 1/2 \\ \hline
1 & 2/3 & 1/3 & 1/2 \\ \hline
f_Y(y) & 1 & 1 & 1
\end{array}
$$
以 $x=0, y=0$ 为例：
$$
g(0|0)=\frac{f(0,0)}{f_Y(0)}=\frac{1/8}{3/8}=\frac{1}{3}
$$
以及，$x=1,y=0$ 的概率是 $2/3$：

$$g(1|0)=\frac{f(1,0)}{f_Y(0)}=\frac{2/8}{3/8}=\frac{2}{3}$$
余下的条件概率以类似方式计算。

同样值得注意的事，对 $Y$ 定义的三个亚群，将 $X=0$ 和 $X=1$ 的概率相加，总是 1。

**问题 2：** 设 X 是支集为 $S_1=\{0,1\}$ 的离散随机变量，Y 是支集为 $S_2=\{0,1,2\}$ 的离散随机变量。假设 $X$ 和 $Y$ 具有如下的联合概率分布 $f(x,y)$：

$$
\begin{array}{c|ccc|c}f(X,Y) & &Y \\ \hline
X& 0 & 1 & 2 & f_X(x) \\ \hline
0 & 1/8 & 2/8 & 1/8 & 4/8 \\ \hline
1 & 2/8 & 1/8 & 1/8 & 4/8 \\ \hline
f_Y(y) & 3/8 & 3/8 & 2/8 & 1
\end{array}
$$
计算给定 $X$ 时 $Y$ 的条件分布，即 $h(y|x)$?

**答：** 使用公式 $h(y|x)=\frac{f(x,y)}{f_X(x)}$ ，其中 $x\in \{0,1\}$，$y\in \{0,1,2\}$，给定 $X$ 时 $Y$ 的条件分布为：

$$
\begin{array}{cc|ccc|c}
&&&Y \\ \hline
&h(y|x) & 0 & 1 & 2 \\ \hline
X & 0 & 1/4 & 2/4 & 1/4 & 1 \\ \hline
 & 1 & 2/4 & 1/4 & 1/4 & 1 \\ \hline
\end{array}
$$
下面以 $x=0, y=0$ 为例解释如何计算这些概率。
$$
h(0|0)=\frac{f(0,0)}{f_X(0)}=\frac{1/8}{4/8}=\frac{1}{4}
$$
以及，$x=0,y=1$ 的概率是 $2/4$：

$$h(1|0)=\frac{f(0,1)}{f_X(0)}=\frac{2/8}{4/8}=\frac{2}{4}$$
以及，$x=0,y=2$ 的概率 $1/4$：

$$h(2|0)=\frac{f(0,2)}{f_X(0)}=\frac{1/8}{4/8}=\frac{1}{4}$$
余下的条件概率以类似方式计算。

现在已经得到给定 $X$ 时 $Y$ 的概率 $h(y|x)$ ，以及给定 $Y$ 时 $X$ 的概率 $g(x|y)$。可以发现，$g(x|y)$ 和 $h(y|x)$ 并不相等，一般来说总是如此。

总结：

1. 条件分布本身是有效的概率质量函数。即条件概率在 0 到 1 之间

$$1\le g(x|y)\le 1 \qquad and \qquad 0\le h(y|x) \le 1$$
且对每个亚群，条件概率和为 1，即：

$$\sum_x g(x|y)=1 \qquad and \qquad \sum_y h(y|x)=1$$

2. 一般来说，给定 $X$ 时 $Y$ 的条件分布与给定 $Y$ 时 $X$ 的条件分布不等。即：

$$g(x|y)\ne h(y|x)$$

## 4. 条件均值和方差

先给出离散随机变量 $X$ 和 $Y$ 的条件均值和方差的定义。

**定义：** 设 $X$ 和 $Y$ 是离散随机变量。

给定 $X=x$ 时 $Y$ 的条件均值为：

$$\mu_{Y|X}=E[Y|x]=\sum_y yh(y|x)$$
给定 $Y=y$ 时 $X$ 的条件均值为：

$$\mu_{X|Y}=E[X|y]=\sum_x xg(x|y)$$
给定 $X=x$ 时 $Y$ 的条件方差为：

$$\sigma^2_{Y|x}=E\{[Y-\mu_{Y|x}]^2|x\}=\sum_y[y-\mu_{Y|x}]^2h(y|x)$$
以及快捷公式：

$$\sigma^2_{Y|x}=E[Y^2|x]-\mu^2_{Y|x}=[\sum_y y^2h(y|x)]-\mu^2_{Y|x}$$
给定 $Y=y$ 时 $X$ 的条件方差为：

$$\sigma^2_{X|y}=E\{[X-\mu_{X|y}]^2|y\}=\sum_x[x-\mu_{X|y}]^2g(x|y)$$
以及快捷公式：

$$\sigma^2_{X|y}=E[X^2|y]-\mu^2_{X|y}=[\sum_x x^2g(x|y)]-\mu^2_{X|y}$$
可以看到，条件均值和条件方差的计算公式与均值和方差的非常相似，只是用条件概率质量函数代替了概率质量函数。

**问题 1：** 设 $X$ 是支集为 $S_1=\{0,1\}$ 的离散随机变量，$Y$ 是支集为 $S_2=\{0,1,2\}$ 的离散随机变量。假设 $X$ 和 $Y$ 具有如下的联合概率分布 $f(x,y)$：

$$
\begin{array}{c|ccc|c}f(X,Y) & &Y \\ \hline
X& 0 & 1 & 2 & f_X(x) \\ \hline
0 & 1/8 & 2/8 & 1/8 & 4/8 \\ \hline
1 & 2/8 & 1/8 & 1/8 & 4/8 \\ \hline
f_Y(y) & 3/8 & 3/8 & 2/8 & 1
\end{array}
$$
- 计算 $X=x$ 时 $Y$ 的条件均值？

前面已经得到给定 $X$ 时 $Y$ 的条件分布：

$$
\begin{array}{cc|ccc|c}
&&&Y \\ \hline
&h(y|x) & 0 & 1 & 2 \\ \hline
X & 0 & 1/4 & 2/4 & 1/4 & 1 \\ \hline
 & 1 & 2/4 & 1/4 & 1/4 & 1 \\ \hline
\end{array}
$$
因此，$X=0$ 时 $Y$ 的条件均值：

$$\mu_{Y|0}=E[Y|0]=\sum_y yh(y|0)=0(\frac{1}{4})+1(\frac{2}{4})+2(\frac{1}{4})=1$$

$X=1$ 时 Y 的条件均值：
$$\mu_{Y|1}=E[Y|1]=\sum_y yh(y|1)=0(\frac{2}{4})+1(\frac{1}{4})+2(\frac{1}{4})=\frac{3}{4}$$
注意，$Y|X=x$ 的条件均值依赖于 $x$，且只依赖于 $x$。另外，条件均值与条件分布一样，依赖于亚群。例如，对 $X=0$ 的亚群，$Y$ 的均值为 1；对 $X=1$ 的亚群，$Y$ 的均值为 $\frac{3}{4}$。这种依赖是有意义的。例如，你可能希望分别得到女性亚群和男性亚群的平均体重，而非所有人的平均体重。

- 计算 $Y=y$ 时 $X$ 的条件均值？

前面已给出给定 $Y$ 时 $X$ 的条件分布：

$$
\begin{array}{c|ccc}
g(x|y) & & Y \\ \hline
X &0 &1 &2 \\ \hline
0 & 1/3 & 2/3 & 1/2 \\ \hline
1 & 2/3 & 1/3 & 1/2 \\ \hline
f_Y(y) & 1 & 1 & 1
\end{array}
$$
如该表所示，给定 $Y$ 时 $X$ 有三个亚群，分别为 $Y=0$, $Y=1$ 和 $Y=2$ 亚群。因此 $X$ 有三个条件均值：
$$\mu_{X|0}=E[X|0]=\sum_x xg(x|0)=0(\frac{1}{3})+1(\frac{2}{3})=\frac{2}{3}$$
$$\mu_{X|1}=E[X|1]=\sum_x xg(x|1)=0(\frac{2}{3})+1(\frac{1}{3})=\frac{1}{3}$$
$$\mu_{X|2}=E[X|2]=\sum_x xg(x|2)=0(\frac{1}{2})+1(\frac{1}{2})=\frac{1}{2}$$

- 计算 $X=0$ 时 $Y$ 的条件方差？

前面已经给出给定 $X$ 时 $Y$ 的条件分布：

$$
\begin{array}{cc|ccc|c}
&&&Y \\ \hline
&h(y|x) & 0 & 1 & 2 \\ \hline
X & 0 & 1/4 & 2/4 & 1/4 & 1 \\ \hline
 & 1 & 2/4 & 1/4 & 1/4 & 1 \\ \hline
\end{array}
$$
因此 $X=0$ 时 $Y$ 的条件方差为：

$$
\begin{aligned}
\sigma^2_{Y|0}&=E\{[Y-\mu_{Y|0}]^2|x\} \\
&=E\{[Y-1]^2|0\} \\
&=\sum_y(y-1)^2h(y|0) \\
&=(0-1)^2(\frac{1}{4})+(1-1)^2(\frac{2}{4})+(2-1)^2(\frac{1}{4}) \\
&=\frac{2}{4}
\end{aligned}
$$
也可以用便捷公式计算：

$$
\begin{aligned}
\sigma^2_{Y|0}&=E[Y^2|0]-\mu_{Y|0}^2 \\
&=[\sum_y y^2h(y|0)]-1^2 \\
&=[(0)^2(\frac{1}{4})+(1)^2(\frac{2}{4})+(2)^2(\frac{1}{4})]-1\\
&=\frac{2}{4}
\end{aligned}
$$
