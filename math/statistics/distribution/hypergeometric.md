# 超几何分布

- [超几何分布](#超几何分布)
  - [简介](#简介)
  - [超几何试验](#超几何试验)
  - [超几何分布概率分布](#超几何分布概率分布)
    - [均值](#均值)
    - [方差](#方差)
  - [概率质量函数](#概率质量函数)
    - [Cumulative distribution function](#cumulative-distribution-function)
  - [性质](#性质)
    - [对称性](#对称性)
    - [抽样顺序](#抽样顺序)
  - [R 函数](#r-函数)
  - [References](#references)

2020-05-12, 15:48
*** *

## 简介

超几何分布（Hypergeometric Distribution）是一种常见的离散概率分布。假设有 N 个物品，其中种类 A 有 K 个，不放回抽样 n 次，抽出种类 A 的个数 k 的概率分布（不放回抽样），就是超几何分布。

对二项分布和几何分布，它们均基于伯努利试验，每次抽样后放回，所以每次试验概率都相同，而超几何分布由于是不放回抽样，所以每次试验的概率会随着试验的发生而改变。

超几何检验（hypergeometric test）使用超几何分布计算 $n$ 次抽样 $k$ 次成功的显著性。该检验通常用于确定样本中哪些表达过量（或者不足）。

## 超几何试验

超几何试验是指满足如下条件的统计试验：

- 从总体 N 中无放回抽取 n 个样本
- 在总体中，K 个表示成功个数，余下 $N-K$ 表示失败个数，即抽样结果只有两种类型
- 每次抽样成功的概率都会改变，因为每次抽样都改变了总体（不放回抽样）

例如，你有一个黑箱子，里面有10个球，5 个红球，5 个绿球。你闭眼从中随机取 2 个（不放回），计算红球的数目。这就是一个典型的超几何试验。

应当注意，超几何试验不是二项试验。二项试验要求每次抽样成功的概率相同，而超几何试验，每次抽样后，下次抽样成功的概率就变了。例如，第一次抽到红球的概率为 $5/10$，假如你第一次抽到了红球，则第二次抽到红球的概率为 $4/9$；如果你第一次抽到绿球，那么第二次抽到红球概率为 $5/9$。

而如果你抽到球后，又放回去，就变成了放回抽样，每次抽样的概率相同，就不是超几何分布，而是二项分布了。

## 超几何分布概率分布

超几何随机变量是超几何试验的成功次数，超几何随机变量的概率分布就称为**超几何分布**（hypergeometric distribution）。

超几何分布的概率质量函数（probability mass function）为：

$P(X=k)=\frac{\binom{K}{k} \binom{N-K}{n-k}}{\binom{N}{n}}$

其形式与超几何函数的级数展开的系数有关，所以称为超几何分布。其中：

- $N$ 是总体大小
- $K$ 是总体中成功的个数（假设总体分为两类，成功和失败，统计抽样结果中成功的个数）
- $n$ 是抽样次数，即样本大小
- $k$ 是抽到的成功次数

所以上面的公式很好理解，即总体 $N$ 中包含成功 $K$，抽样 $n$ 次，抽到成功 $k$ 个的概率。

随机变量 $X$ 满足超几何分布写成 $X \text{\textasciitilde} Hypergeometric(N, K, n)$，简写为 $X \text{\textasciitilde} H(N, K, n)$。

### 均值

$\mu = n*K/N$

### 方差

$D(X)=\frac{n*K*(N-K)}{N^2(N-1)}$

## 概率质量函数

Probability mass function 分布图：

![pmf](2020-05-13-08-30-49.png)

### Cumulative distribution function

累积超几何概率分布（cumulative hypergeometric probability）是指超几何随机变量值位于某个范围的概率。例如，取球试验，你想知道最多取到 2 个红球的概率，即取到 0 个、1个、2个三种情况概率的加和。

再比如，桌上有一副扑克牌（52张， $N=52$），你想抽红桃，一副牌有 13 张红桃，所以$K=13$，你从中随机抽取 5 张（$n=5$），那么抽到至多 2 个红心的概率（$x=0, 1, 2$）:

$H(x\leq2;52,5,13)\\=H(x=0;52,5,13)+H(x=1;52,5,13)+H(x=2;52,5,13)\\=C_{13}^0C_{39}^5/C_{52}^5+C_{13}^1C_{39}^4/C_{52}^5+C_{13}^2C_{39}^3/C_{52}^5\\=0.2215+0.4114+0.2743\\=0.9072$

下面是一个累积概率分布图：

![cdf](2020-05-13-08-32-09.png)

## 性质

不放回抽样是超几何分布的经典应用，假设箱子里有两个类型的球，红球和绿球，假设抽到绿球表示成功，抽到红球表示失败，假设箱子里共有 N 个球，其中绿球 K 个，红球 $N-K$个。随机变量 X 表示抽到 k 个绿球的事件。如下面的交叉表所示：

|      | 抽到  | 未抽        | 总数 |
| ---- | ----- | ----------- | ---- |
| 绿球 | $k$   | $K-k$       | $K$  |
| 红球 | $n-k$ | $N-K-(n-k)$ | N-K  |
| 总数 | $n$   | $N-n$       | $N$  |

现在假设有 5 个绿球，45 个红球。现在你闭上眼，从箱子中抽 10 个球，不放回。则 10 个球中有 4 个绿球的概率是多少？

交叉表：

|      | 抽到    | 未抽           | 总数     |
| ---- | ------- | -------------- | -------- |
| 绿球 | $k=4$   | $K-k=1$        | $K=5$    |
| 红球 | $n-k=6$ | $N-K-(n-k)=39$ | $N-K=45$ |
| 总数 | $n=10$  | $N-n=40$       | $N=50$   |

抽到 k 个红球的概率为：

$P(X=k)=f(k; N,K,n)=\frac{\binom{K}{k} \binom{N-K}{n-k}}{\binom{N}{n}}$

对该实例为：

$P(X=4)=f(4;50,5,10)=\frac{\binom{5}{4}\binom{45}{6}}{\binom{50}{10}}=0.003964583$

取出 5 个绿球的概率肯定更低：

$P(X=5)=f(5;50,5,10)=\frac{\binom{5}{5}\binom{45}{5}}{\binom{50}{10}}=0.000118937$

和预期一样，取出 5 个绿球的概率远低于取出 4 个绿球的概率。

### 对称性

红球和绿球分布一致：

$f(k;N,K,n)=f(n-k;N,N-K,n)$

抽出来的和没抽出来的一致：

$f(k;N,K,n)=f(K-k;N,K,N-n)$

选择红球或绿球分布一致：

$f(k;N,K,n)=f(k;N,n,K)$

### 抽样顺序

抽样概率只和红球和绿球的数目有关，而和出现的顺序无关。因此第 $i^{th}$ 次抽到绿球的概率为：

$P(G_i)=\frac{K}{N}$

当然这是事前概率，即不知道之前抽样的结果。

## R 函数

## References

- [Wikipedia](https://en.wikipedia.org/wiki/Hypergeometric_distribution)
- [STAT TREK](https://stattrek.com/probability-distributions/hypergeometric.aspx)
