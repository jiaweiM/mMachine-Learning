# LMDB

- [LMDB](#lmdb)
  - [简介](#简介)
  - [LMDB 应用场景](#lmdb-应用场景)
  - [LMDB 不适用场景](#lmdb-不适用场景)
  - [其它嵌入数据库](#其它嵌入数据库)
  - [总结](#总结)
  - [参考](#参考)

Last updated: 2022-12-08, 14:34
****

## 简介

LMDB 是一个有序的、嵌入式的、持久的使用 B+ Tree 进行键值存储策略。用 C 语言编写，跨平台，并且拥有几十种编程语言的第三方包装器。开源、成熟且应用广泛。

在磁盘上，LMDB 通常由单个数据文件表示，在使用时还包括一个锁文件。单个 LMDB 可以存储许多单独的数据库（每个数据库可以看做一个表格或映射）。在单个 LMDB 文件可以跨多个数据库进行操作。

LMDB 对存储的数据类型基本无定义，也没有 schema 或类似功能。

## LMDB 应用场景

LMDB 适合操作简单、性能要求高的持久化。

虽然 LMDB 在许多类型的程序中得到应用，但是它主要特点为：

- 关键事务操作，如 LDAP、DNA 和缓存服务器
- 数据密集型应用，如金融市场
- 低延迟系统，如实时用户分析
- 高级别数据库，如分布式 noSQL 数据库

LMDB 为这类系统提供高效且简单的键值存储。

每个 LMDB 环境包含一个文件加一个锁文件组成。因为 LMDB 是嵌入式数据库，所以可以直接访问底层数据。大多数数据库需要序列化和进程间通讯机制。此外，由于 LMDB 以 B+ Tree 内存映射文件实现，所以提供了对键值和双向排序的快速访问。由于 LMDB 在运行时只使用一对文件，因此从文件处理角度看也是高效的。

## LMDB 不适用场景

LMDB 是按键值存储，它的目标不是成为一个高级数据库，因此缺乏这类数据的基本功能：

- 数据库 schema
- 临时查询
- 客户端访问

高级数据库通常提供类似 SQL 的功能、编写查询，从客户端访问数据等。这对需要存储数十年跨越多代客户端技术的数据来说直观重要。

除了结束上的差异，高级数据库作为记录系统已经被广泛理解和接受，在安全、监控、工具、行业熟悉度、供应商支持、托管云版本等其它领域都配备了良好支持。

尽管如此，大多数高级数据库的核心依然是有序键值对存储。你也可以在 LMDB 的基础上构建高级别特性，不过从成本上考虑不值得这么做，除非你只需要一点点高级特性。

还有一些情况 LMDB 不适合：

- 缺乏可以识别锁的文件系统（如 NFS 系统）
- 并发写
- 最小的写入延迟（LMDB 在写入时维护 B+ Tree）
- 需要内置压缩

## 其它嵌入数据库

有许多开源数据库可以嵌入到 Java 应用程序。下面列出一些比较成熟的、可维护的额、广泛使用的数据库。

如果需要功能丰富支持 SQL 的数据库，但希望简化嵌入式存储，则 [H2 Database](https://h2database.com/html/main.html), [HSQLDB](http://hsqldb.org/) 和 [Apache Derby](https://db.apache.org/derby/) 是不错的选择。它们不能提供 LMDB 的高性能，但是支持 SQL，并且可以轻松地迁移到其它 SQL 数据库。

如果需要写操作比 LMDB 更快的嵌入式键值数据库，则可以选择 [LSM](https://en.wikipedia.org/wiki/Log-structured_merge-tree) 存储系列。包括 Level DB 和 RocksDB，它们都提供内置压缩。LSM 模式的缺点是，它需要许多文件来存储数据，并且在运行时需要复杂的操作、调优等。对大多数读取和迭代操作，它们也更慢。

要存储大量 column 数据，并且保持操作简单，则可以考虑 Apache ORC, Apache Parquet 和 HDF。这些格式在不同编程环境中得到广泛支持，大部分是自描述的，并且通常提供内置压缩功能。

三元格式数据（subject-predicate-object）最好存储在 [triplestore](https://en.wikipedia.org/wiki/Triplestore)。Java 选项包括 Eclipse RDF4J 和 Apache Jena。

## 总结

LMDB 适合高效、简单的键值存储，它是一个键值存储库，而不是高级数据库。

## 参考

- https://github.com/lmdbjava/lmdbjava/wiki/Is-LMDB-A-Good-Fit%3F
